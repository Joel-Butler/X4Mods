<?xml version="1.0" encoding="utf-8"?>
<mdscript name="Jbm_crew_dock_actions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
        <cue name="Jbm_on_owned_mlxml_dock" instantiate="true" >
			<!-- 
				Logic:
					1. Is the ship a player ship.
					2. Is it of size M, L or XL
					3. Does it have at least one crewmember outside of the captain (we'll assume for now the captain is going to be busy. 

					      <xs:element name="event_object_docked">
							<xs:annotation>
							<xs:documentation>
								Event for the specified object docking (object = docking object, param = dock object, param2 = zone)
							</xs:documentation>
							</xs:annotation>
							<xs:complexType>
							<xs:attributeGroup ref="eventcondition" />
							<xs:attributeGroup ref="objecteventsource" />
							<xs:attribute name="dock" type="container" />
							<xs:attribute name="zone" type="zone" />
							</xs:complexType>
						</xs:element>
			-->
			<conditions>
				<check_all>
					<event_object_docked group="global.$PlayerShipsGroup"/>
					<check_value value="event.object.trueowner" exact="faction.player" />
				</check_all>
				<check_any>
					<check_value value="event.object.isclass.ship_l" />
					<check_value value="event.object.isclass.ship_m" />
					<check_value value="event.object.isclass.ship_xl" />
				</check_any>
			</conditions>
			<actions>
				<!-- So the important thing here is that to query a crew member, you must reference it via the parent object... in this case our ship. 							
				-->
				<set_value name="$sourceShip" exact="event.object" />
				<set_value name="$disorderlyCrewTemplate" exact="$sourceShip.people.{entityrole.service}.list.random" />
				<set_value name="$disorderlyCrewGender" exact="if $sourceShip.people.{$disorderlyCrewTemplate}.isfemale then 'female' else 'male'" />>
				<debug_to_file name="'jbmcrew.txt'" text="'Docking Event for ship: ' + $sourceShip.name + ' size: ' + $sourceShip.class + ' Engineer workforce: ' + $sourceShip.people.{entityrole.service}.list.count" />
				<debug_to_file name="'jbmcrew.txt'" text="'Selected ' + $sourceShip.people.{$disorderlyCrewTemplate}.name + ' ' +  $sourceShip.people.{$disorderlyCrewTemplate}.race + ' ' +  $disorderlyCrewGender + ', engineer of ' + $sourceShip.name + ' for fun and profit :-)'" />	
				<remove_npc_template object="$sourceShip" template="$disorderyCrewTemplate" />
				<create_npc_from_template object="" template="$disorderyCrewTemplate" owner="faction.alliance" setroomslot="true" required="true" placementobject=""></create_npc_from_template>
				<!-- Todo: 
					1. Transfer the crew member to the Docked station
					2. Transfer the ownership of the crew member (temporarily) to the related faction and store them permanently.
					3. Raise a mission cue to go get them, or not as your avatar sees fit.
				-->
				
			</actions>
		</cue>
  </cues>
</mdscript>